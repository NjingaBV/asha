name: CodeQL Security Scan

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]
    schedule:
        # Run at 6:00 AM UTC every Monday
        - cron: '0 6 * * 1'

# Cancel in-progress runs for pull requests when new commits are pushed
concurrency:
    group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
    cancel-in-progress: true

jobs:
    analyze:
        name: Analyze
        runs-on: ubuntu-latest
        permissions:
            actions: read
            contents: read
            security-events: write

        strategy:
            fail-fast: false
            matrix:
                language: ['javascript-typescript']

        steps:
            - name: Checkout repository
              uses: actions/checkout@v5

            - name: Initialize CodeQL
              uses: github/codeql-action/init@v4
              with:
                  languages: ${{ matrix.language }}
                  # If you want to specify custom queries, you can do so here
                  # queries: security-extended,security-and-quality

            - name: Autobuild
              uses: github/codeql-action/autobuild@v4

            - name: Perform CodeQL Analysis
              uses: github/codeql-action/analyze@v4
              with:
                  category: '/language:${{matrix.language}}'
